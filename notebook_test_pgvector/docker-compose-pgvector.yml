version: '3.8'

services:
  # PostgreSQL with pgvector extension pre-installed
  postgres-pgvector:
    image: pgvector/pgvector:pg16
    container_name: agenthub_postgres_pgvector_test
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres  # Change this!
      POSTGRES_DB: agenthub_chatbot_test
    ports:
      - "5433:5432"  # Using 5433 to avoid conflict with existing PostgreSQL
    volumes:
      - pgvector_test_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql  # Optional: initialization script
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  pgvector_test_data:
    driver: local

# Usage:
# 1. Start: docker-compose -f docker-compose-pgvector.yml up -d
# 2. Stop: docker-compose -f docker-compose-pgvector.yml down
# 3. View logs: docker-compose -f docker-compose-pgvector.yml logs -f
# 4. Connect: psql -h localhost -p 5433 -U postgres -d agenthub_chatbot_test
#
# To use in notebook, update DB_CONFIG:
# DB_CONFIG = {
#     'host': 'localhost',
#     'port': 5433,  # Note: port 5433
#     'database': 'agenthub_chatbot_test',
#     'user': 'postgres',
#     'password': 'postgres'
# }
